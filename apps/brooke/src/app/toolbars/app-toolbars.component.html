@let widgets = app.widgets();
@let appState = app.appState();
@let resources = app.resources();
@if (widgets && appState && resources) {
  @if (!widgets.fullscreen()) {
    <mat-toolbar color="primary" class="flex flex-align-center">
      <mat-toolbar-row>
        <mat-icon fontSet="material-symbols-outlined">newsstand</mat-icon>
				<div class="flex flex-column flex-align-center flex-no-gap font-bold margin-top-8">
        	<h1>Brooke</h1>
					<span class="version">{{ version }}</span>
				</div>
        @if (!widgets.isMobile()) {
          @if (appState.currentCollection()) {
            @let collectionLabel = appState.currentItem() ? '...' : appState.currentCollection()?.displayName;
            <mat-icon fontSet="material-symbols-outlined">chevron_right</mat-icon>
            <mat-chip-and-remove [label]="collectionLabel" (removed)="app.openHome()" />
          }
          @if (appState.currentCategory()) {
            @let categoryLabel =
              appState.currentSeries() || appState.currentItem() ? '...' : appState.currentCategory()?.displayName;
            <mat-icon fontSet="material-symbols-outlined">chevron_right</mat-icon>
            <mat-chip-and-remove [label]="categoryLabel" (removed)="app.openCollection()" />
          }
          @if (appState.currentSeries()) {
            <mat-icon fontSet="material-symbols-outlined">chevron_right</mat-icon>
            <mat-chip-and-remove [label]="appState.currentSeries()?.displayName" (removed)="app.openCategory()" />
          }
          @if (appState.currentItem()) {
            <mat-icon fontSet="material-symbols-outlined">chevron_right</mat-icon>
            <mat-chip-and-remove [label]="appState.currentItem()?.name" (removed)="app.openCategory()" />
          }
        }
        <span class="spacer"></span>

        @if (!widgets.panel.showBook()) {
          <button matMiniFab (click)="appState.showLibraryEditorManual.set(true)" title="Modify Categories">
            <mat-icon fontSet="material-symbols-outlined">library_books</mat-icon>
          </button>
          <button matMiniFab title="Write Categories">
            <mat-icon fontSet="material-symbols-outlined">sync_arrow_up</mat-icon>
          </button>
          <button matMiniFab (click)="appState.showSettingsManual.set(true)">
            <mat-icon fontSet="material-symbols-outlined">settings</mat-icon>
          </button>
        }
        @if (widgets.book.thumbnailView()) {
          <button matMiniFab (click)="app.updateItem()" title="Save">
            <mat-icon fontSet="material-symbols-outlined">save</mat-icon>
          </button>
        }

        @if (widgets.panel.showBook()) {
          @if (resources.bookCbt.hasValue()) {
            @let book = resources.bookCbt.value();
            @let page = appState.currentPageSet();
            @let pageSize = widgets.book.pagesInDisplay();
            <span class="pages-of">
              @if (pageSize === 1 || page + 1 >= book.length) {
                {{ page + 1 }} / {{ book.length }}
              } @else {
                {{ page + 1 }}, {{ page + 2 }} / {{ book.length }}
              }
            </span>
            <previous-page-action></previous-page-action>
            <next-page-action></next-page-action>
          }
        }
      </mat-toolbar-row>
    </mat-toolbar>
  }
}

<div class="fh-body flex flex-align-start flex-no-wrap">
  <span class="fh-body width-auto flex flex-column flex-align-center toolbar" id="toolbar">
    <toggle-fullscreen-action></toggle-fullscreen-action>
    <toggle-orator-action></toggle-orator-action>
    <button
      matMiniFab
      title="Book Options"
      popovertarget="book-options"
    >
      <!--  [disabled]="!app.widgets().panel.showBook() || app.widgets().book.thumbnailView()" -->
      <mat-icon fontSet="material-symbols-outlined">book_2</mat-icon>
    </button>
    <toggle-toc-action></toggle-toc-action>
    <toggle-add-toc-action></toggle-add-toc-action>
    <button matMiniFab title="Scroll to Top" (click)="app.scrollToTop()" [disabled]="!app.appState().currentCollection()">
      <mat-icon fontSet="material-symbols-outlined">arrow_circle_up</mat-icon>
    </button>
    <close-action></close-action>
  </span>

  <span class="fh-body width-auto" id="book-options" popover anchor="toolbar">
    <div class="flex flex-column flex-align-center toolbar" >
      <toggle-markdown-view-action></toggle-markdown-view-action>
      <toggle-thumbnail-view-action></toggle-thumbnail-view-action>
      <toggle-num-pages-action></toggle-num-pages-action>
      <toggle-side-by-side-action></toggle-side-by-side-action>
    </div>
  </span>

  <ng-content></ng-content>
</div>

